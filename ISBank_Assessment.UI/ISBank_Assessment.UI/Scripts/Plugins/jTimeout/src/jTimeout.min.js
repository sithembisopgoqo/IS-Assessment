(function(n){n.jTimeout=function(t){var i,r;return typeof jTimeout!="undefined"?window.jTimeout:(t=n.extend({},n.jTimeout.defaults,t),i={expiration_key:"jtimeout-session-expiration",timedOut:!1,timeoutWarning:!1,interval:!1,mouseTimeout:!1,options:t,get:function(n){return window.localStorage.getItem(n)},set:function(n,t){return window.localStorage.setItem(n,t)},getExpiration:function(){return this.get(this.expiration_key)},setExpiration:function(n){var t=new Date;return t.setSeconds(t.getSeconds()+n),this.set(this.expiration_key,t)},resetExpiration:function(){return this.setExpiration(this.options.timeoutAfter),this},getSecondsTillExpiration:function(){var n=Math.round((new Date(this.getExpiration()).getTime()-(new Date).getTime())/1e3);return n<=0?0:n},stopPriorCountdown:function(){i.priorCountDown&&(i.priorCountDown=!1)},resetOnAlert:function(){return i.options.triggerResetOnAlert?n("#jTimedoutAlert").length===0&&i.options.triggerResetOnAlert:n("#jTimeoutAlert").length===0&&n("#jTimedoutAlert").length===0},stopFlashing:function(){i.options.flashTitle&&(i.flashingTitle&&window.clearInterval(i.flashingTitle),i.flashingTitle=!1,document.title=i.options.originalTitle)},startFlashing:function(){!i.flashingTitle&&i.options.flashTitle&&(i.flashingTitle=window.setInterval(function(){document.title=document.title===i.options.flashingTitleText?i.options.originalTitle:i.options.flashingTitleText},i.options.flashTitleSpeed))},startPriorCountdown:function(n){i.priorCountDown=n},hideCountdownAlert:function(){i.timeoutWarning=!1;var t=n("#jTimeoutAlert");t.length>0&&t.closeAlert()},setMouseTimeout:function(n){this.mouseTimeout=n},stopMouseTimeout:function(){this.mouseTimeout&&window.clearTimeout(this.mouseTimeout)},stopActivityMonitoring:function(){i.stopMouseTimeout()},startActivityMonitoring:function(){i.stopActivityMonitoring();i.options.extendOnMouseMove&&(r=i.options.mouseDebounce*1e3,i.mouseMoved=!1,i.setMouseTimeout(window.setTimeout(function(){n("body").on("mousemove.jTimeout",function(){if(!i.mouseMoved&&i.resetOnAlert()){i.mouseMoved=!0;i.setMouseTimeout(window.setTimeout(function(){i.mouseMoved=!1},r));i.options.onMouseMove(i)}})},r)))},setCountdown:function(n){this.interval=n},countdown:function(){var t=i.getExpiration(),n=i.getSecondsTillExpiration();if(i.priorCountDown&&i.priorCountDown.text(n),n<=0&&!i.timedOut){i.timeoutWarning=!0;i.timedOut=!0;i.options.onTimeout(i);i.stopActivityMonitoring()}else if(n>0&&i.timedOut){i.timeoutWarning=!1;i.timedOut=!1;i.options.onSessionExtended(i);i.startActivityMonitoring()}else if(n<i.options.secondsPrior&&!i.timeoutWarning){i.timeoutWarning=!0;i.startFlashing();i.options.onPriorCallback(i,n)}else n>=i.options.secondsPrior&&i.timeoutWarning&&(i.stopFlashing(),i.stopPriorCountdown(),i.hideCountdownAlert())},destroy:function(){i.stopFlashing();i.stopActivityMonitoring();delete i.options.onSessionExtended;delete i.countdown;n("body").off("mousemove.jTimeout")}},i.resetExpiration(),r=i.options.heartbeat*1e3,i.setCountdown(window.setInterval(i.countdown,r)),i.startActivityMonitoring(),window.jTimeout=i,i)};n.jTimeout.reset=function(t){var i=typeof t=="undefined"?n.jTimeout.defaults.timeoutAfter:t;n.jTimeout().setExpiration(i)};n.jTimeout.defaults={flashTitle:!0,flashTitleSpeed:500,flashingTitleText:"**WARNING**",originalTitle:document.title,timeoutAfter:1440,heartbeat:1,extendOnMouseMove:!0,mouseDebounce:30,onMouseMove:function(t){n.get({url:t.options.extendUrl,cache:!1,success:function(){t.resetExpiration()}})},extendUrl:"/dashboard",logoutUrl:"/logout",loginUrl:"/login",secondsPrior:60,triggerResetOnAlert:!1,onPriorCallback:function(t,i){n.jAlert({id:"jTimeoutAlert",title:"Oh No!",content:'<b>Your session will timeout in <span class="jTimeout_Countdown">'+i+"<\/span> seconds!<\/b>",theme:"red",closeBtn:!1,onOpen:function(n){t.startPriorCountdown(n.find(".jTimeout_Countdown"))},btns:[{text:"Extend my Session",theme:"blue",onClick:function(n,i){n.preventDefault();t.options.onClickExtend(t);return i.parents(".jAlert").closeAlert(),!1}},{text:"Logout Now",onClick:function(n){return n.preventDefault(),window.location.href=t.options.logoutUrl,!1}}]})},onClickExtend:function(t){n.get({url:t.options.extendUrl,cache:!1});t.resetExpiration()},onTimeout:function(t){n.jAlert({id:"jTimedoutAlert",title:"Oh No!",content:"<b>Your session has timed out.<\/b>",theme:"red",btns:{text:"Login Again",href:t.options.loginUrl,theme:"blue",closeAlert:!1},closeOnClick:!1,closeBtn:!1,closeOnEsc:!1});n.get(t.options.logoutUrl)},onSessionExtended:function(){n("#jTimedoutAlert").closeAlert()}}})(jQuery);